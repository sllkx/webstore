document.addEventListener("DOMContentLoaded",(function(){if(window.FHLWidgetInitialized)return;window.FHLWidgetInitialized=!0;let e=[],t=1,n=!1,o=null;const c=document.getElementById("fhl-widget-container"),s=document.getElementById("fhl-widget-wrapper"),i=document.getElementById("fhl-list-container"),a=document.getElementById("fhl-search-input"),r=document.getElementById("fhl-search-results"),l=document.getElementById("fhl-app-search-trigger"),d=document.getElementById("fhl-search-close"),m=document.getElementById("fhl-indicator-track"),h=document.getElementById("fhl-scroll-indicator"),u=document.getElementById("fhl-add-to-home-btn"),p=document.getElementById("fhl-search-add-btn"),g=(document.getElementById("fhl-toast-notification"),document.getElementById("fhl-mode-toggle")),f=document.getElementById("fhl-toggle-icon"),v=(document.getElementById("fhl-mode-input-area"),document.getElementById("fhl-mode-input")),y=document.getElementById("fhl-mode-close"),E=document.createElement("div");E.id="fhl-scroll-sentinel";const L=[{name:"",urlParam:"chat=",icon:"Communication/chat-ai-line.svg",ph:""},{name:"",urlParam:"search=",icon:"System/search-ai-line.svg",ph:""},{name:"",urlParam:"image=",icon:"Media/image-circle-ai-line.svg",ph:""},{name:"",urlParam:"video=",icon:"Media/clapperboard-ai-fill.svg",ph:""},{name:"",urlParam:"video=",icon:"Media/music-ai-fill.svg",ph:""}];let w=0,b=!1;const C="https://isai.kr",I=e=>{try{const t=new URL(e);return`${t.protocol}//${t.hostname}`}catch(t){return e}},k=(e,t="default")=>{if(!e||!e.url)return document.createDocumentFragment();const n=document.createElement("a");if("search"===t){const t=shortcutManager.getAsParam();let o=e.url;if(t)try{let n=new URL(e.url);const[c,s]=t.split("=");n.searchParams.set(c,s),o=n.toString()}catch(e){}n.href=o}else n.href=e.url;if(n.className="fhl-icon-display",n.rel="nofollow",n.setAttribute("aria-label",e.name||""),e.name){const t=document.createElement("span");t.className="fhl-item-tooltip";const o=e.name.length>4?e.name.substring(0,4)+"..":e.name;t.textContent=o,n.appendChild(t)}"search"===t&&(n.addEventListener("mousedown",(()=>{fetch(`${C}/update_view_count.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url})}).catch(console.error)})),n.target="_blank");const o=document.createElement("div");o.className="fhl-icon-circle";const c="search"===t?"lazy":"eager";if(e.icon&&e.icon.includes("svg")){const t=document.createElement("img");t.src=e.icon,t.className="remix-icon",t.loading=c,o.appendChild(t)}else if(e.icon&&e.icon.startsWith("ph-")){const e=document.createElement("img");e.src="https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/System/star-line.svg",e.className="remix-icon",o.appendChild(e)}else if(e.img){const t=document.createElement("img");t.src=e.img,t.alt="",t.loading=c,t.onerror=()=>{t.style.display="none"},o.appendChild(t)}else{const t=document.createElement("img");t.src=`https://www.google.com/s2/favicons?sz=64&domain_url=${e.url}`,t.alt="",t.loading=c,t.onerror=()=>{t.style.display="none"},o.appendChild(t)}if(n.appendChild(o),"local"===t){const t=document.createElement("div");t.className="fhl-item-controls";const o=document.createElement("button");o.className="fhl-control-btn",o.innerHTML="&times;",o.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();let n=shortcutManager.get();n=n.filter((t=>t.url!==e.url)),shortcutManager.set(n),B([])}));const c=document.createElement("button");c.className="fhl-control-btn",c.innerHTML="&gt;",c.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();let n=shortcutManager.get();const o=n.findIndex((t=>t.url===e.url));if(o>-1){const e=(o+1)%n.length,[t]=n.splice(o,1);n.splice(e,0,t),shortcutManager.set(n),B([])}})),t.appendChild(o),t.appendChild(c),n.appendChild(t)}return n},M=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&x()}))}),{root:r,rootMargin:"100px",threshold:.1}),x=()=>{if(n||!e.length)return;n=!0,M.unobserve(E);const o=document.createDocumentFragment(),c=24*(t-1);for(let t=0;t<24;t++){const n=(c+t)%e.length;o.appendChild(k(e[n],"search"))}E.remove(),r.appendChild(o),r.appendChild(E),t++,setTimeout((()=>{n=!1,M.observe(E)}),50)},B=(e=[])=>{i.innerHTML='<button class="fhl-icon-circle" style="border:0" id="fhl-edit-mode-btn"><img src="https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/System/settings-5-line.svg" class="remix-icon"></button>';const t=document.getElementById("fhl-edit-mode-btn");t&&(i.classList.contains("edit-mode")&&t.classList.add("active"),t.addEventListener("click",(()=>{i.classList.toggle("edit-mode")})));const n={name:"webstore",url:"https://webstore.isai.kr/"},o=shortcutManager.get(),c=o.filter((e=>I(e.url)!==I(n.url))),s=e.filter((e=>!o.some((t=>t.url===e.url))&&I(e.url)!==I(n.url))),a=[n,...c,...s],r=document.createDocumentFragment();a.forEach((e=>{const t=!o.some((t=>t.url===e.url))||e.icon||e.img||e.url===n.url?"default":"local";r.appendChild(k(e,t))})),i.appendChild(r),S(),(()=>{const e=shortcutManager.getAsParam();e&&document.querySelectorAll("#fhl-widget-container .fhl-icon-display, #fhl-widget-container .fhl-fixed-item").forEach((t=>{if("A"===t.tagName){const n=t.getAttribute("href");if(!n||n.startsWith("#"))return;try{let o=new URL(n);const[c,s]=e.split("=");o.searchParams.set(c,s),t.href=o.toString(),t.rel="nofollow"}catch(e){}}}))})()},T=n=>{r.innerHTML="",t=1,e=Array.isArray(n)?n:[],M.disconnect(),x()};fetch("https://isai.kr/app_list_cache.json").then((e=>e.json())).then((e=>{T(e),B([])})).catch((e=>{B([])}));const P=async(e="")=>{try{let t;t=e&&""!==e.trim()?`${C}/appapi2.php?query=${encodeURIComponent(e)}`:"https://isai.kr/app_list_cache.json";const n=await fetch(t);if(!n.ok)throw new Error("API Error");const o=await n.json();T(o)}catch(e){r.innerHTML=""}},j=()=>{const e=i.scrollLeft,t=i.scrollWidth-i.clientWidth;if(t<=0)return;const n=e/t*(m.clientWidth-h.clientWidth);h.style.transform=`translateY(-50%) translateX(${n}px)`},S=()=>{const e=i.scrollWidth>i.clientWidth;c.classList.toggle("scrollable",e),e&&j()};let W=!1;const N=e=>{if(!W)return;e.preventDefault();const t=m.getBoundingClientRect(),n=i.scrollWidth-i.clientWidth;let o=(e.clientX-t.left)/t.width;o=Math.max(0,Math.min(1,o)),i.scrollLeft=o*n},_=()=>{W&&(W=!1,document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",_))};m.addEventListener("mousedown",(e=>{W=!0,N(e),document.addEventListener("mousemove",N),document.addEventListener("mouseup",_)}));const A=()=>{c.classList.remove("search-mode"),s.classList.remove("search-mode"),a.value="",r.innerHTML=""};let D=null;c.addEventListener("mouseenter",(()=>{clearTimeout(D)})),c.addEventListener("mouseleave",(()=>{D=setTimeout((()=>{c.classList.add("hidden")}),6e3)})),document.addEventListener("click",(e=>{c.contains(e.target)||(c.classList.contains("hidden")&&setTimeout((()=>{c.classList.remove("hidden"),clearTimeout(D),D=setTimeout((()=>{c.classList.add("hidden")}),6e3)}),50),A())})),i.addEventListener("scroll",j),window.addEventListener("resize",S),l.addEventListener("click",(()=>{c.classList.add("search-mode"),s.classList.add("search-mode"),a.focus(),P()})),a.addEventListener("input",(function(){clearTimeout(o);const e=this.value.toLowerCase().trim();o=setTimeout((()=>{P(e)}),300)})),d.addEventListener("click",A),document.addEventListener("keydown",(e=>{"Escape"===e.key&&s.classList.contains("search-mode")&&A()}));const H=()=>{const e=L[w];f.src=`https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/${e.icon}`,v.placeholder=e.ph};g.addEventListener("click",(()=>{b?(w=(w+1)%L.length,H()):(b=!0,c.classList.add("mode-active"),w=0,H(),v.focus())})),y.addEventListener("click",(()=>{b=!1,c.classList.remove("mode-active"),f.src="https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/System/search-ai-line.svg",v.value=""})),v.addEventListener("keydown",(e=>{if("Enter"===e.key){const e=v.value.trim(),t=L[w];e&&(window.location.href=`https://isai.kr/?${t.urlParam}${encodeURIComponent(e)}`)}})),u.addEventListener("click",(async e=>{e.preventDefault();const t=I(window.location.href);let n="";try{const e=await fetch(`${C}/get_title.php?url=${encodeURIComponent(t)}`);if(e.ok){const t=await e.json();t.title&&(n=t.title)}}catch(e){}const o={name:n,url:t};let c=shortcutManager.get();if(!c.some((e=>I(e.url)===I(o.url)))){c.length>=10&&c.shift(),c.push(o),shortcutManager.set(c);try{await fetch(`${C}/register_app.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}catch(e){}B([]),s.classList.contains("search-mode")&&A()}})),p.addEventListener("click",(e=>{e.preventDefault();const t="<script src='https://isai.kr/re_total.js'><\/script>",n=()=>{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.top=0,e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(e)};navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then((()=>{})).catch((()=>{n()})):n()})),shortcutManager.syncFromURL(),shortcutManager.get()}));
