document.addEventListener("DOMContentLoaded",(function(){if(window.FHLWidgetInitialized)return;window.FHLWidgetInitialized=!0;let e=[],t=1,n=!1,c=null;const o=document.getElementById("fhl-widget-container"),s=document.getElementById("fhl-widget-wrapper"),i=document.getElementById("fhl-list-container"),a=document.getElementById("fhl-search-input"),r=document.getElementById("fhl-search-results"),l=document.getElementById("fhl-app-search-trigger"),d=document.getElementById("fhl-search-close"),m=document.getElementById("fhl-indicator-track"),h=document.getElementById("fhl-scroll-indicator"),u=document.getElementById("fhl-add-to-home-btn"),p=document.getElementById("fhl-search-add-btn"),g=(document.getElementById("fhl-toast-notification"),document.getElementById("fhl-mode-toggle")),f=document.getElementById("fhl-toggle-icon"),v=(document.getElementById("fhl-mode-input-area"),document.getElementById("fhl-mode-input")),y=document.getElementById("fhl-mode-close"),E=document.createElement("div");E.id="fhl-scroll-sentinel";const L=[{name:"",urlParam:"chat=",icon:"Communication/chat-ai-line.svg",ph:""},{name:"",urlParam:"search=",icon:"System/search-ai-line.svg",ph:""},{name:"",urlParam:"image=",icon:"Media/image-circle-ai-line.svg",ph:""},{name:"",urlParam:"video=",icon:"Media/clapperboard-ai-fill.svg",ph:""},{name:"",urlParam:"video=",icon:"Media/music-ai-fill.svg",ph:""}];let w=0,C=!1;const b="https://isai.kr",I=e=>{try{const t=new URL(e);return`${t.protocol}//${t.hostname}`}catch(t){return e}},M=(t,n="default")=>{if(!t||!t.url)return document.createDocumentFragment();const c=document.createElement("a");if("search"===n){const e=shortcutManager.getAsParam();let n=t.url;if(e)try{let c=new URL(t.url);const[o,s]=e.split("=");c.searchParams.set(o,s),n=c.toString()}catch(e){}c.href=n}else c.href=t.url;if(c.className="fhl-icon-display",c.rel="nofollow",c.setAttribute("aria-label",t.name||""),t.name){const e=document.createElement("span");e.className="fhl-item-tooltip";const n=t.name.length>4?t.name.substring(0,4)+"..":t.name;e.textContent=n,c.appendChild(e)}"search"===n&&(c.addEventListener("mousedown",(()=>{fetch(`${b}/update_view_count.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t.url})}).catch(console.error)})),c.target="_blank");const o=document.createElement("div");o.className="fhl-icon-circle";const s="search"===n?"lazy":"eager";if(t.icon&&t.icon.includes("svg")){const e=document.createElement("img");e.src=t.icon,e.className="remix-icon",e.loading=s,o.appendChild(e)}else if(t.icon&&t.icon.startsWith("ph-")){const e=document.createElement("img");e.src="https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/System/star-line.svg",e.className="remix-icon",o.appendChild(e)}else if(t.img){const e=document.createElement("img");e.src=t.img,e.alt="",e.loading=s,e.onerror=()=>{e.style.display="none"},o.appendChild(e)}else{const e=document.createElement("img");e.src=`https://www.google.com/s2/favicons?sz=64&domain_url=${t.url}`,e.alt="",e.loading=s,e.onerror=()=>{e.style.display="none"},o.appendChild(e)}if(c.appendChild(o),"local"===n){const n=document.createElement("div");n.className="fhl-item-controls";const o=document.createElement("button");o.className="fhl-control-btn",o.innerHTML="&times;",o.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation();let c=shortcutManager.get();c=c.filter((e=>e.url!==t.url)),shortcutManager.set(c),B(e.slice(0,8))}));const s=document.createElement("button");s.className="fhl-control-btn",s.innerHTML="&gt;",s.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation();let c=shortcutManager.get();const o=c.findIndex((e=>e.url===t.url));if(o>-1){const t=(o+1)%c.length,[n]=c.splice(o,1);c.splice(t,0,n),shortcutManager.set(c),B(e.slice(0,8))}})),n.appendChild(o),n.appendChild(s),c.appendChild(n)}return c},k=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&x()}))}),{root:r,rootMargin:"100px",threshold:.1}),x=()=>{if(n||!e.length)return;n=!0,k.unobserve(E);const c=document.createDocumentFragment(),o=24*(t-1);for(let t=0;t<24;t++){const n=(o+t)%e.length;c.appendChild(M(e[n],"search"))}E.remove(),r.appendChild(c),r.appendChild(E),t++,setTimeout((()=>{n=!1,k.observe(E)}),50)},B=(e=[])=>{i.innerHTML='<button class="fhl-icon-circle" style="border:0" id="fhl-edit-mode-btn"><img src="https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/System/settings-5-line.svg" class="remix-icon"></button>';const t=document.getElementById("fhl-edit-mode-btn");t&&(i.classList.contains("edit-mode")&&t.classList.add("active"),t.addEventListener("click",(()=>{i.classList.toggle("edit-mode")})));const n=shortcutManager.get(),c=e.filter((e=>!n.some((t=>t.url===e.url)))),o=[...n,...c],s=document.createDocumentFragment();o.forEach((e=>{const t=!n.some((t=>t.url===e.url))||e.icon||e.img?"default":"local";s.appendChild(M(e,t))})),i.appendChild(s),W(),(()=>{const e=shortcutManager.getAsParam();e&&document.querySelectorAll("#fhl-widget-container .fhl-icon-display, #fhl-widget-container .fhl-fixed-item").forEach((t=>{if("A"===t.tagName){const n=t.getAttribute("href");if(!n||n.startsWith("#"))return;try{let c=new URL(n);const[o,s]=e.split("=");c.searchParams.set(o,s),t.href=c.toString(),t.rel="nofollow"}catch(e){}}}))})()},T=n=>{r.innerHTML="",t=1,e=Array.isArray(n)?n:[],k.disconnect(),x()};fetch("/app_list_cache.json").then((e=>e.json())).then((e=>{T(e);const t=Array.isArray(e)?e.slice(0,8):[];B(t)})).catch((e=>{B([])}));const P=async(e="")=>{try{const t=await fetch(`${b}/appapi2.php?query=${encodeURIComponent(e)}`);if(!t.ok)throw new Error("API Error");const n=await t.json();T(n)}catch(e){r.innerHTML=""}},S=()=>{const e=i.scrollLeft,t=i.scrollWidth-i.clientWidth;if(t<=0)return;const n=e/t*(m.clientWidth-h.clientWidth);h.style.transform=`translateY(-50%) translateX(${n}px)`},W=()=>{const e=i.scrollWidth>i.clientWidth;o.classList.toggle("scrollable",e),e&&S()};let j=!1;const A=e=>{if(!j)return;e.preventDefault();const t=m.getBoundingClientRect(),n=i.scrollWidth-i.clientWidth;let c=(e.clientX-t.left)/t.width;c=Math.max(0,Math.min(1,c)),i.scrollLeft=c*n},N=()=>{j&&(j=!1,document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",N))};m.addEventListener("mousedown",(e=>{j=!0,A(e),document.addEventListener("mousemove",A),document.addEventListener("mouseup",N)}));const D=()=>{o.classList.remove("search-mode"),s.classList.remove("search-mode"),a.value="",r.innerHTML=""};let _=null;o.addEventListener("mouseenter",(()=>{clearTimeout(_)})),o.addEventListener("mouseleave",(()=>{_=setTimeout((()=>{o.classList.add("hidden")}),6e3)})),document.addEventListener("click",(e=>{o.contains(e.target)||(o.classList.contains("hidden")&&setTimeout((()=>{o.classList.remove("hidden"),clearTimeout(_),_=setTimeout((()=>{o.classList.add("hidden")}),6e3)}),50),D())})),i.addEventListener("scroll",S),window.addEventListener("resize",W),l.addEventListener("click",(()=>{o.classList.add("search-mode"),s.classList.add("search-mode"),a.focus(),P()})),a.addEventListener("input",(function(){clearTimeout(c);const e=this.value.toLowerCase().trim();c=setTimeout((()=>{P(e)}),300)})),d.addEventListener("click",D),document.addEventListener("keydown",(e=>{"Escape"===e.key&&s.classList.contains("search-mode")&&D()}));const H=()=>{const e=L[w];f.src=`https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/${e.icon}`,v.placeholder=e.ph};g.addEventListener("click",(()=>{C?(w=(w+1)%L.length,H()):(C=!0,o.classList.add("mode-active"),w=0,H(),v.focus())})),y.addEventListener("click",(()=>{C=!1,o.classList.remove("mode-active"),f.src="https://cdn.jsdelivr.net/npm/remixicon@4.9.1/icons/System/search-ai-line.svg",v.value=""})),v.addEventListener("keydown",(e=>{if("Enter"===e.key){const e=v.value.trim(),t=L[w];e&&(window.location.href=`https://isai.kr/?${t.urlParam}${encodeURIComponent(e)}`)}})),u.addEventListener("click",(async t=>{t.preventDefault();const n=I(window.location.href);let c="";try{const e=await fetch(`${b}/get_title.php?url=${encodeURIComponent(n)}`);if(e.ok){const t=await e.json();t.title&&(c=t.title)}}catch(e){}const o={name:c,url:n};let i=shortcutManager.get();if(!i.some((e=>I(e.url)===I(o.url)))){i.length>=10&&i.shift(),i.push(o),shortcutManager.set(i);try{await fetch(`${b}/register_app.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}catch(e){}B(e.slice(0,8)),s.classList.contains("search-mode")&&D()}})),p.addEventListener("click",(e=>{e.preventDefault();const t="<script src='https://isai.kr/re_total.js'><\/script>",n=()=>{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.top=0,e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(e)};navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then((()=>{})).catch((()=>{n()})):n()})),shortcutManager.syncFromURL(),shortcutManager.get()}));
